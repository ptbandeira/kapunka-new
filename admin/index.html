<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
  <div id="nc-root"></div>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    (function () {
      "use strict";

      function initPreview() {
        var CMS = window.CMS;
        var createElement = window.h || (window.React && window.React.createElement);
        if (!CMS || !createElement) {
          window.setTimeout(initPreview, 50);
          return;
        }

        var defaultLocale = 'en';
        var supportedLocales = ['en', 'pt', 'es'];
        var localeLinksContainerId = 'cms-preview-locale-links';
        var latestEntryLocale = null;
        var refreshScheduled = false;

        function getLocaleFromPath(path) {
          if (typeof path !== 'string') {
            return null;
          }
          var match = path.match(/\/(en|pt|es)\//);
          return match ? match[1] : null;
        }

        function parseHashInfo() {
          var hash = window.location.hash || '';
          if (!hash) {
            return null;
          }

          var questionIndex = hash.indexOf('?');
          var base = questionIndex === -1 ? hash : hash.slice(0, questionIndex);
          var queryString = questionIndex === -1 ? '' : hash.slice(questionIndex + 1);
          var params = new window.URLSearchParams(queryString);
          var segments = base.replace(/^#\/?/, '').split('/').filter(Boolean);

          if (segments.length < 4 || segments[0] !== 'collections' || segments[2] !== 'entries') {
            return {
              view: 'other',
              base: base,
              params: params,
              collection: segments[1] || '',
              locale: params.get('locale') || null
            };
          }

          return {
            view: 'entry',
            base: base,
            params: params,
            collection: segments[1] || '',
            slug: segments[3] || '',
            locale: params.get('locale') || null
          };
        }

        function buildLocaleHash(base, params, locale) {
          var cloned = new window.URLSearchParams(params.toString());
          cloned.set('locale', locale);
          var search = cloned.toString();
          return search ? base + '?' + search : base;
        }

        function findPreviewHeader() {
          var selectors = [
            '[data-testid="preview-pane-top-bar"]',
            '[class*="PreviewPaneTopBar"]',
            '[class*="PreviewPaneHeader"]',
            '[class*="PreviewPane"] [class*="TopBar"]'
          ];

          for (var i = 0; i < selectors.length; i += 1) {
            var node = document.querySelector(selectors[i]);
            if (node) {
              return node;
            }
          }

          return null;
        }

        function ensureLocaleContainer(header) {
          if (!header) {
            return null;
          }

          var container = header.querySelector('#' + localeLinksContainerId);

          if (!container) {
            container = document.createElement('div');
            container.id = localeLinksContainerId;
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.fontSize = '11px';
            container.style.letterSpacing = '0.08em';
            container.style.textTransform = 'uppercase';
            container.style.gap = '6px';
            container.style.marginLeft = 'auto';
            container.style.color = '#486581';
            container.style.userSelect = 'none';
            header.appendChild(container);
          }

          return container;
        }

        function renderLocaleLinks() {
          var header = findPreviewHeader();
          if (!header) {
            return;
          }

          var container = ensureLocaleContainer(header);
          if (!container) {
            return;
          }

          var info = parseHashInfo();
          if (!info || info.view !== 'entry' || info.collection !== 'pages') {
            container.style.display = 'none';
            return;
          }

          var activeLocale = info.locale || latestEntryLocale || defaultLocale;
          container.style.display = 'flex';
          container.innerHTML = '';

          for (var i = 0; i < supportedLocales.length; i += 1) {
            var locale = supportedLocales[i];
            var link = document.createElement('a');
            link.href = buildLocaleHash(info.base, info.params, locale);
            link.textContent = locale.toUpperCase();
            link.style.color = '#243b53';
            link.style.opacity = locale === activeLocale ? '1' : '0.6';
            link.style.textDecoration = 'none';
            link.style.cursor = locale === activeLocale ? 'default' : 'pointer';

            container.appendChild(link);

            if (i < supportedLocales.length - 1) {
              var separator = document.createElement('span');
              separator.textContent = '|';
              separator.style.opacity = '0.35';
              container.appendChild(separator);
            }
          }
        }

        function scheduleLocaleRender() {
          if (refreshScheduled) {
            return;
          }

          refreshScheduled = true;
          window.requestAnimationFrame(function () {
            refreshScheduled = false;
            renderLocaleLinks();
          });
        }

        function noteEntryLocale(entry) {
          if (!entry || typeof entry.get !== 'function') {
            return;
          }

          var path = entry.get('path');
          var localeFromPath = getLocaleFromPath(path);
          if (localeFromPath) {
            latestEntryLocale = localeFromPath;
          }
        }

        window.addEventListener('hashchange', scheduleLocaleRender);
        scheduleLocaleRender();

        var containerStyle = {
          fontFamily: 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
          padding: '24px',
          lineHeight: '1.5',
          color: '#1f2933',
          backgroundColor: '#f8fafc'
        };

        var heroStyle = {
          backgroundColor: '#ffffff',
          border: '1px solid #d9e2ec',
          borderRadius: '12px',
          padding: '24px',
          marginBottom: '24px',
          boxShadow: '0 4px 12px rgba(15, 23, 42, 0.08)'
        };

        var badgeStyle = {
          display: 'inline-block',
          fontSize: '12px',
          letterSpacing: '0.08em',
          textTransform: 'uppercase',
          color: '#486581',
          backgroundColor: '#e0f2fe',
          padding: '4px 8px',
          borderRadius: '999px',
          marginBottom: '12px'
        };

        var heroHeadlineStyle = {
          fontSize: '28px',
          fontWeight: '600',
          margin: '0 0 12px',
          color: '#102a43'
        };

        var heroSubStyle = {
          margin: '0',
          fontSize: '18px',
          color: '#334e68'
        };

        var sectionListStyle = {
          backgroundColor: '#ffffff',
          border: '1px solid #d9e2ec',
          borderRadius: '12px',
          padding: '24px',
          boxShadow: '0 4px 12px rgba(15, 23, 42, 0.08)'
        };

        var sectionListHeadingStyle = {
          margin: '0 0 16px',
          fontSize: '20px',
          fontWeight: '600',
          color: '#102a43'
        };

        var sectionGridStyle = {
          display: 'grid',
          gridTemplateColumns: 'repeat(auto-fit, minmax(180px, 1fr))',
          gap: '16px'
        };

        var sectionCardStyle = {
          border: '1px solid #d9e2ec',
          borderRadius: '10px',
          padding: '16px',
          backgroundColor: '#f8fafc'
        };

        var sectionMetaStyle = {
          fontSize: '12px',
          textTransform: 'uppercase',
          letterSpacing: '0.08em',
          color: '#829ab1',
          marginBottom: '8px'
        };

        var sectionTitleStyle = {
          fontSize: '16px',
          fontWeight: '500',
          margin: '0',
          color: '#243b53'
        };

        var emptyStateStyle = {
          margin: '0',
          fontSize: '14px',
          color: '#829ab1'
        };

        function getSectionTitle(section) {
          if (!section || typeof section !== 'object') {
            return 'Untitled section';
          }

          var candidates = [
            section.title,
            section.heading,
            section.headline,
            section.label,
            section.name
          ];

          for (var i = 0; i < candidates.length; i += 1) {
            var candidate = candidates[i];
            if (candidate && String(candidate).trim()) {
              return String(candidate);
            }
          }

          if (Array.isArray(section.items) && section.items.length > 0) {
            var first = section.items[0];
            if (first && (first.title || first.heading || first.label)) {
              return String(first.title || first.heading || first.label);
            }
          }

          return section.type ? String(section.type) : 'Untitled section';
        }

        function HomePreview(props) {
          var entry = props.entry;
          var heroHeadline = entry.getIn(['data', 'heroHeadline']) || '';
          var heroSubheadline = entry.getIn(['data', 'heroSubheadline']) || '';
          var sectionsData = entry.getIn(['data', 'sections']);
          var sectionItems = [];

          if (sectionsData) {
            if (typeof sectionsData.toJS === 'function') {
              sectionItems = sectionsData.toJS();
            } else if (Array.isArray(sectionsData)) {
              sectionItems = sectionsData;
            }
          }

          var sectionCards = sectionItems.map(function (section, index) {
            var typeLabel = section && section.type ? String(section.type) : 'Section ' + (index + 1);
            var titleText = getSectionTitle(section);
            return createElement(
              'div',
              { key: index, style: sectionCardStyle },
              createElement('div', { style: sectionMetaStyle }, typeLabel),
              createElement('div', { style: sectionTitleStyle }, titleText || 'Untitled section')
            );
          });

          noteEntryLocale(entry);
          scheduleLocaleRender();

          return createElement(
            'div',
            { style: containerStyle },
            createElement(
              'section',
              { style: heroStyle },
              createElement('div', { style: badgeStyle }, 'Home hero'),
              createElement('h1', { style: heroHeadlineStyle }, heroHeadline || 'Hero headline'),
              heroSubheadline ? createElement('p', { style: heroSubStyle }, heroSubheadline) : null
            ),
            createElement(
              'section',
              { style: sectionListStyle },
              createElement('h2', { style: sectionListHeadingStyle }, 'Sections'),
              sectionCards.length
                ? createElement('div', { style: sectionGridStyle }, sectionCards)
                : createElement('p', { style: emptyStateStyle }, 'Add sections to preview them here.')
            )
          );
        }

        var homeTemplates = ['home_en', 'home_es', 'home_pt'];
        homeTemplates.forEach(function (template) {
          CMS.registerPreviewTemplate(template, HomePreview);
        });
      }

      initPreview();
    })();
  </script>
</body>
</html>
